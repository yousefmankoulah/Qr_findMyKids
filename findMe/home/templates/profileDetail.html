{% extends "base.html" %}
{% load static %}

{% block content %}


{% for qr in qr  %}
{% if request.user != qr.parent %}
    <h1>Please call the phone number below</h1>
{% endif %}
<div class="container lead">
{{qr.name}}<br>
{{qr.type}}<br>
{{qr.address}}<br>
{{qr.phoneNumber}}<br>
{{qr.summary}}<br>


{% if request.user == qr.parent %}

{% if qr.qr %}
<img src="{{qr.qr.url}}" id="parent">

{% endif %}
<br>
<button class="btn btn-primary printit" onclick='myApp.printDiv()'>Print QR Code</button>
<a class="btn btn-primary" href="{% url 'updateProfile' qr.id %}">Edit Profile</a>
<a class="btn btn-info" href="{% url 'profileVistorLocation' qr.id %}">Last Vistor Location</a>
<a class="btn btn-danger" href="{% url 'delete' qr.id %}">Delete Profile</a>

</div><br><br>
{% else %}
<a class="btn btn-primary" href="tel:{{qr.phoneNumber}}">Call Their parent now</a><br>

{% endif %}


{% endfor %}

{% if request.user != profile.parent %}

<script>
    $(document).ready(function () {
        navigator.geolocation.getCurrentPosition((position) => {
            let lat = position.coords.latitude;
            let long = position.coords.longitude;
            console.log(lat, long);
    
            // Get the CSRF token from the page
            let csrfToken = $('input[name=csrfmiddlewaretoken]').val();
            let profileId = '{{ profile.id }}';
    
            // Concatenate the profile.id to the URL
            let url = `/profileDetail/${profileId}/`;
    
            // Send the AJAX request
            $.ajax({
                type: 'GET',
                url: url,
                data: {
                    'latitude': lat,
                    'longitude': long,
                    'csrfmiddlewaretoken': csrfToken
                },
                success: function (response) {
                    // Handle the response from the server
                    console.log(response);
                },
                error: function (error) {
                    // Handle errors
                    console.error(error);
                }
            });
        });
    });
    
  </script>
    {% endif %}
{% endblock %}